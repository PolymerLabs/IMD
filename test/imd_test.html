<!doctype html>

<html>
  <head>
    <title><%= name %> test</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <script src="/components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="/components/web-component-tester/browser.js"></script>
    <link rel="import" href="../imd.html">
  </head>
  <body>
    <script>
      suite('basic', () => {

        setup(() => {
          // clear the global set of modules before each test
          Object.keys(define._modules).forEach((key) => {
            delete define._modules[key];
          });
        });

        test('a module with no dependencies is executed', (done) => {
          let ran = false;
          let m = {};
          // Spec doesn't actually say what define returns. I've chaned
          // it to return nothing. It could return also return Promise,
          // which would make it somewhat easier to test but requires a
          // a small polyfill.
          define('test1', () => {
            ran = true;
            return m;
          });
          define(['test1'], (module) => {
            assert.strictEqual(module, m);
            done();
          });
          assert.isTrue(ran);
        });

        test('a module with no id is executed', () => {
          let ran = false;
          let m = {};
          define(() => {
            ran = true;
            return m;
          });
          assert.isTrue(ran);
        });

        test('default dependencies are requre, exports, module', () => {
          define('test-module', (require, exports, module) => {
            assert.typeOf(require, 'function');
            assert.deepEqual(exports, {});
            assert.equal(module.id, 'test-module');
          });
        });

        test('a defined dependency is loaded', () => {
          let aModule = {};
          define('a', aModule);
          define('b', ['a'], (a) => {
            assert.strictEqual(a, aModule);
          });
        });

        test('a relative dependency is loaded', () => {
          let aModule = {};
          define('m/a', aModule);
          // make sure that './a' resolves to 'm/a' when loaded from 'm'
          define('m', ['./a'], (a) => {
            assert.strictEqual(a, aModule);
          });
        });

        test('out of order dependencies work', (done) => {
          // make sure that './a' resolves to 'm/a' when loaded from 'm'
          let aModule = {};
          define('b', ['a'], (a) => {
            assert.strictEqual(a, aModule);
            done();
          });
          define('a', aModule);
        });

        test('relative out-of-order dependencies also work.', (done) => {
          let aModule = {};
          // make sure that './a' resolves to 'm/a' when loaded from 'm'
          define('m', ['./a'], (a) => {
            assert.strictEqual(a, aModule);
            done();
          });
          define('m/a', aModule);
        });
      });
    </script>
  </body>
</html>
